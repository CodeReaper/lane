name: Release

on:
  pull_request: {}
  release:
    types:
      - published

jobs:
  version:
    name: Setup version
    if: github.actor != 'dependabot[bot]'
    runs-on: ubuntu-latest
    steps:
      - name: Output real version
        if: github.event_name == 'release'
        id: real
        run: echo "version=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT

      - name: Output faked version
        if: github.event_name == 'pull_request'
        id: fake
        run: echo "version=0.0.0" >> $GITHUB_OUTPUT

      - name: Build release
        uses: ./.github/workflows/build-release.yaml
        with:
          version: ${{ steps.real.outputs.version || steps.fake.outputs.version }}
          event_name: ${{ github.event_name }}
